# üíª Import and Export Excel file User Guide

The ‚ÄòImport/Export schemas from/to Excel‚Äô UI menu options trigger the process of seamless transformation of schemas written in Excel into valid Guardian JSON schemas, and vice versa. The content of such schema excel files must conform to the format presented in the template accessible via the corresponding button on the 'Policy Schemas‚Äô page. The menu options for actioning Import and Export are accessible via the ‚ÄòManage Policies‚Äô and ‚ÄòPolicy Schemas‚Äô pages.

In Guardian schemas usually exist within a Policy, a Tool or embedded into another schema. To ease the process when a schema or a set of schemas are imported, they get imported into a context of a policy. Users can create a new empty policy for such purposes or use an existing policy. In the latter case all existing schemas in the policy are preserved (and can be manually deleted later), new schemas are added together with the basic policy blocks scaffolding which is inserted at the beginning of the policy flow.

When schemas are exported, they are packaged into a single Excel file formatted like the template mentioned above. It is recommended to experiment with exporting your existing policies and reviewing the resulting excel files so you can familiarize yourself with the format and the content.

1. [Step By Step Process](import-and-export-excel-file-user-guide.md#id-1.-step-by-step-process)
2. [Demo Video](import-and-export-excel-file-user-guide.md#id-2.-demo-video)

## 1. Step By Step Process

### 1. Import

Use the corresponding menu option : **Import schemas from Excel** in the Manage Policies or Policy Schemas pages.

<figure><img src="../../../.gitbook/assets/0 (13).png" alt=""><figcaption></figcaption></figure>

Import section pops up where we need to upload .xlsx file:

<figure><img src="../../../.gitbook/assets/1 (15).png" alt=""><figcaption></figcaption></figure>

#### 1.1 Errors

In case, when the importing engine was unable to parse the content of the given excel file then Guardian indicates the existence of the problem to the user, and gives an option to skip the invalid part to continue importing by clicking on **Skip & Import** button:

![](<../../../.gitbook/assets/2 (17).png>)

In cases, where the importing engine was not able to parse the content of a field then Guardian would specifically highlight this field in the schema after the import in red color rows:\\

![](<../../../.gitbook/assets/3 (14).png>)

![](<../../../.gitbook/assets/4 (12).png>)

#### 1.2 Blocks

Importing schemas into a Guardian policy will result in a number of new autogenerated blocks appearing in the beginning of the policy flow which ‚Äòhold‚Äô each imported schema and its tool or form as shown in the screenshot below.

![](<../../../.gitbook/assets/5 (15).png>)

#### 1.3 Template

Guardian provides a basic downloadable Excel schema template which contains all possible types and structural elements supported by the system for importing. This template can be downloaded by clicking on the button highlighted in screenshot below:

![](<../../../.gitbook/assets/6 (14).png>)

<figure><img src="../../../.gitbook/assets/7 (14).png" alt=""><figcaption></figcaption></figure>

All schemas created for importing into Guardian must follow the design of the template containing the following elements:

* _**Schema name**_ ‚Äì unique schema name (also used in the name of the page and is limited to 30 characters)
* _**Description** (optional)_ ‚Äì schema description
* _**Schema Type**_ ‚Äì the value in this field influences the type of the signature and additional system fields
  * **Verifiable Credentials (VC)** ‚Äì linked to the policy and can be used in forms.
  * **Encrypted Verifiable Credential (EVC)** ‚Äì linked to the policy and can be used in forms. Unlike a simple VC it gets encrypted when saved into IPFS.
  * **Sub-Schema (None)** ‚Äì schemas without additional system fields which are suitable for embedded data.
* _**Tool**_ _(optional) ‚Äì_ name of the Tool to which this schema belongs
* _**Tool Id**_ ‚Äì message id of the Tool to which this schema belongs (if relevant)

{% hint style="info" %}
**Note:** If the imported schema belongs to a Tool (not a Policy) - i.e. there is a Tool ID setting as per above - all extended information about the schema will not be processed during import. Since Tools are immutable and can only be referenced the only relevant information that would be used in the import is the Tool ID.
{% endhint %}

* Table listing each field which the schema contains.

{% hint style="info" %}
**Note:** The order of the columns in the spreadsheet is irrelevant.
{% endhint %}

* _**Required Field**_ - this field must be filled our (Yes/No)
* _**Field Type**_ ‚Äì type of the data matching that of Schema concepts in Guardian
  * Enum
  * Number
  * Integer
  * String
  * Pattern ‚Äì text field (String) which gets validated against the specified pattern
  * Boolean
  * Date
  * Time
  * DateTime
  * Duration
  * URL
  * URI
  * Email
  * Image
  * Help Text
  * GeoJSON
  * Prefix
  * Postfix
  * HederaAccount
  * Auto-Calculate
  * **Sub-schema name** ‚Äì the name of the embedded schema (or the name of the tag in the spreadsheet)
* _**Parameter**_ ‚Äì additional field for information relevant for some data types
  * Enum ‚Äì name of the enumeration (or the name of the tab in the spreadsheet) - list of possible options
  * Pattern ‚Äì regular expression
  * Help Text ‚Äì text style
  * Prefix ‚Äì symbol
  * Postfix ‚Äì symbol
* _**Visibility**_ ‚Äì determines the visibility of the field for user
  * No ‚Äì always hidden
  * EXACT({FieldName},{Value}) ‚Äì only shown when the condition is true
  * NOT(EXACT({FieldName},{Value})) ‚Äì only shown when the condition is not true
* _**Question**_ ‚Äì Description of the field. This is the text which users would see when filling out the form in Guardian.
* _**Allow Multiple Answers**_ ‚Äì Determines if the data is an array or a single item (Yes/No)
* _**Answer**_ ‚Äì example of the valid data

{% hint style="info" %}
**Note:** Currently only expression containing simple arithmetic operations are supported for **Auto-Calculate** in the _**Answer.**_ When specified it would result an the generation of the function template as shown on the example below.
{% endhint %}

![](<../../../.gitbook/assets/8 (15).png>)

### 2. Export

Use the corresponding menu option : **Export schemas to Excel** in the Manage Policies or Policy Schemas pages.

![](<../../../.gitbook/assets/9 (13).png>)

![](<../../../.gitbook/assets/10 (14).png>)

### 3. Calculations and math expressions

1. **How to specify them in Excel schemas**

For math expressions in Excel schema documents to be recognised by Guardian the following is required

1\.     **‚ÄòField Type‚Äô** value set to **‚ÄúAuto-Calculate‚Äù**

<figure><img src="../../../.gitbook/assets/image (466).png" alt=""><figcaption></figcaption></figure>

2. The expression specified in the corresponding cell in the ‚ÄúAnswer‚Äù column

<figure><img src="../../../.gitbook/assets/image (467).png" alt=""><figcaption></figcaption></figure>

Expressions can contain references to cells in the ‚ÄòAnswer‚Äô column from the current schema (as shown above) and all embedded schemas. To use fields from embedded schemas these fields need to be added to the parent (current) schema as shown below.

<figure><img src="../../../.gitbook/assets/image (465).png" alt=""><figcaption></figcaption></figure>

These field from embedded schemas must be grouped to ‚Äòfold‚Äô under the main field as on the example below.

<figure><img src="../../../.gitbook/assets/image (464).png" alt=""><figcaption></figcaption></figure>

Only the fields that are used in the expression need to be brought into the parent schema, all the others don‚Äôt need to be mentioned.

The fields from embedded schema definition tab (e.g. titled as ‚ÄòProduction Device‚Äô on the screenshot below) and their duplicates in the parent schema where they used for calculations expression must be identical at all times as best observed via values in the ‚ÄòQuestion' column.'

<figure><img src="../../../.gitbook/assets/image (463).png" alt=""><figcaption></figcaption></figure>

2. **How they are processed by Guardian on import**

On import for each VC schema imported Guardian will create basic scaffolding of Policy block, which includes  ‚Äú_requestVcDocumentBlock‚Äù and a ‚ÄúcustomLogicBlock‚Äù_ if the imported schema contained‚ÄôAuto-Calculate‚Äô fields.

<figure><img src="../../../.gitbook/assets/image (462).png" alt=""><figcaption></figcaption></figure>

**Structure of the ‚ÄòcustomLogicBlock‚Äô code**

1. Each customLogicBlock starts with a comment listing all pre-defined variable which contain data referenceable in the code.

<figure><img src="../../../.gitbook/assets/image (468).png" alt=""><figcaption></figcaption></figure>

documents ‚Äì array containing VC documents passed to the customLogicBlock on entry

user ‚Äì user which is executing the block

artifacts ‚Äì array containing files linked with the block

mathjs ‚Äì reference to the mathjs library object allowing the use its functions in the script ([https://mathjs.org/](https://mathjs.org/))

formulajs ‚Äì reference to the formulajs library object allowing the use its functions in the script ([https://formulajs.info/](https://formulajs.info/))

done ‚Äì special function to finish the execution of the script

2. Helper function

<figure><img src="../../../.gitbook/assets/image (469).png" alt=""><figcaption></figcaption></figure>

Schema structure does not allow to leave empty fields in the resulting document. If he expression allows for an empty value (for example in the ‚Äòif‚Äô operator) then after the execution of the expression the field needs to be checked for empty value, and deleted if it‚Äôs empty. This is done by calling the clearUnsetField function as shown on the example below.

<figure><img src="../../../.gitbook/assets/image (470).png" alt=""><figcaption></figcaption></figure>

3. Description of the functions used in the expressions in the  customLogicBlock

For each function Guardian generates a template which helpfully lists in the comments the expressions in which the function is used.

If the function from the Excel file is supported by the formulajs library Guardian will automatically generated the corresponding method call as shown on the examples below.

<figure><img src="../../../.gitbook/assets/image (471).png" alt=""><figcaption></figcaption></figure>

If the Excel contains unsupported function Guardian would generate the comment as shown below. In these cases policy authors need to manually add the code replicating the original Excel functionality.

<figure><img src="../../../.gitbook/assets/image (472).png" alt=""><figcaption></figcaption></figure>

4. Main calculations

The main body of the script is incapsulated into the ‚Äòmain‚Äô function and consist of the following main sections:\
\
\- Declaration of the used variables

\- Execution of the expressions

\- Retiring of the resulting document

<figure><img src="../../../.gitbook/assets/image (474).png" alt=""><figcaption></figcaption></figure>

In the cases where a variable used in the expression is absent in the VC document Guardian will generate a corresponding error comment in the code:

<figure><img src="../../../.gitbook/assets/image (475).png" alt=""><figcaption></figcaption></figure>

If Guardian was unable to parse the expression for any reason the following error comment would be placed in the code:

<figure><img src="../../../.gitbook/assets/image (476).png" alt=""><figcaption></figcaption></figure>

5. ‚ÄòEntry‚Äô function starting the execution of the calculation

<figure><img src="../../../.gitbook/assets/image (477).png" alt=""><figcaption></figcaption></figure>

## 2. Demo Video

[Youtube](https://www.youtube.com/watch?v=o-4NHLREyBo\&list=PLnld0e1pwLhqdR0F9dusqILDww6uZywwR\&index=14\&t=1s)
