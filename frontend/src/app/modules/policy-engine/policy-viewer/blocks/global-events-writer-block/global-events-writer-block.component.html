<div class="gew-card">
    <div class="gew-header">
        <div class="gew-title">
            Global Events Writer
        </div>

        <div class="gew-header-actions">
            <button
                type="button"
                pButton
                class="button gew-header-btn"
                label="Add Event Topic"
                (click)="openAddTopicModal()"
                [disabled]="loading"
            >
            </button>

            <button
                type="button"
                pButton
                class="button gew-header-btn"
                label="Create Topic"
                (click)="openCreateTopicModal()"
                [disabled]="loading"
            >
            </button>
        </div>
    </div>

    <div class="gew-table">
        <div class="gew-row gew-row-head">
            <div class="gew-cell gew-col-topic">
                TOPIC ID
            </div>

            <div class="gew-cell gew-col-active">
                ACTIVE
            </div>

            <div class="gew-cell gew-col-type">
                TYPE
            </div>

            <div class="gew-cell gew-col-actions"></div>
        </div>

        <div
            class="gew-row"
            *ngFor="let row of streams; trackBy: trackByTopicId"
        >
            <div class="gew-cell gew-col-topic">
                <div class="gew-topic-value">
                    {{ row.topicId }}
                </div>

                <span class="ger-default-pill" *ngIf="isDefaultTopic(row.topicId)">
                    DEFAULT
                </span>
            </div>

            <div class="gew-cell gew-col-active">
                <label class="gew-checkbox">
                    <input
                        type="checkbox"
                        [checked]="row.active"
                        (change)="onActiveCheckboxChange(row, $event)"
                        [disabled]="loading"
                    />
                    <span></span>
                </label>
            </div>

            <div class="gew-cell gew-col-type">
                <select
                    class="gew-select"
                    [ngModel]="row.documentType"
                    (ngModelChange)="onStreamDocumentTypeChange(row, $event)"
                    [disabled]="loading || !documentTypeOptions.length"
                >
                    <option
                        *ngFor="let opt of documentTypeOptions"
                        [ngValue]="opt.value"
                    >
                        {{ opt.label }}
                    </option>
                </select>
            </div>

            <div class="gew-cell gew-col-actions">
                <button
                    type="button"
                    class="gew-icon-btn gew-icon-btn-danger"
                    (click)="deleteStream(row)"
                    [disabled]="loading"
                    *ngIf="!isDefaultTopic(row.topicId)"
                    aria-label="Delete topic"
                    title="Delete"
                >
                    <i class="pi pi-trash"></i>
                </button>
            </div>
        </div>

        <div class="gew-empty" *ngIf="!streams || streams.length === 0">
            No topics configured yet.
        </div>
    </div>
</div>

<app-add-event-topic-modal
    [visible]="addTopicModalOpen"
    [loading]="loading"
    (cancel)="closeAddTopicModal()"
    (add)="confirmAddTopicModal($event)"
>
</app-add-event-topic-modal>

<div class="progress-footer" id="block-progress-footer" *ngIf="showNextButton">
    <div></div>
    <div>
        <button
            type="button"
            pButton
            class="p-button"
            label="Next"
            (click)="onNext()"
            [disabled]="loading"
            form="roles-form"
        >
        </button>
    </div>
</div>
