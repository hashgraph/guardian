<div class="dialog-header">
    <div class="header-container">
        <div class="header-text">{{dialogTitle}}</div>
    </div>
    <div class="header-icon" (click)="onClose()">
        <svg-icon src="/assets/images/icons/close.svg" svgClass="icon-color-close"></svg-icon>
    </div>
</div>
<div class="dialog-body">
    <div *ngIf="loading" class="guardian-loading">
        <div class="guardian-loading-image"></div>
    </div>
    <div class="dialog-body-container">
        <div *ngIf="restoreData" class="restore-data">
            <svg-icon class="svg-icon"
                src="/assets/images/icons/info.svg"
                svgClass="icon-color-primary">
            </svg-icon>
            <b>There is some data to restore. You can restore latest values:</b>
            <button
                (click)="onRestoreClick()"
                class="guardian-button guardian-button-primary">
                <div class="guardian-button-icon">
                    <svg-icon class="icon-btn svg-icon"
                        src="/assets/images/icons/16/refresh.svg"
                        svgClass="icon-color-secondary">
                    </svg-icon>
                </div>
                <div class="guardian-button-label">Restore Values</div>
            </button>
        </div>
        <div *ngIf="dryRun" class="restore-data">
            <svg-icon class="svg-icon"
                src="/assets/images/icons/info.svg"
                svgClass="icon-color-primary">
            </svg-icon>
            <b>Dry run mode. You can fill this document with test data:</b>
            <button
                (click)="onDryRun()"
                class="guardian-button guardian-button-primary">
                <div class="guardian-button-icon">
                    <svg-icon class="icon-btn svg-icon"
                        src="/assets/images/icons/16/refresh.svg"
                        svgClass="icon-color-secondary">
                    </svg-icon>
                </div>
                <div class="guardian-button-label">Test</div>
            </button>
        </div>
        <div *ngIf="wallet" class="wallet-steps">
            <div class="guardian-step-container">
                <div class="guardian-stepper horizontal-stepper">
                    <div class="guardian-step" [attr.action]="isActionStep(0)" [attr.disabled]="isStep(0)" (click)="setStep(0)">
                        <div class="guardian-step-marker">1</div>
                        <div class="guardian-step-name">Fill Form</div>
                    </div>
                    <div class="guardian-step-separator"></div>
                    <div class="guardian-step" [attr.action]="isActionStep(1)" [attr.disabled]="!isStep(2)" (click)="setStep(1)">
                        <div class="guardian-step-marker">2</div>
                        <div class="guardian-step-name">Configure Wallet</div>
                    </div>
                    <div class="guardian-step-separator"></div>
                    <div class="guardian-step" [attr.action]="isActionStep(2)" [attr.disabled]="true">
                        <div class="guardian-step-marker">3</div>
                        <div class="guardian-step-name">Validation Results</div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="schema" class="body-dialog-template">
            <ng-template #preloader>
                <div class="preloader-image"></div>
            </ng-template>
            <form (ngSubmit)="onStep()" [formGroup]="dataForm" [attr.visibility]="isStep(0)">
                <div class="form-dialog" [attr.dry-run]="!!dryRun" [attr.restore]="!!restoreData">
                    <app-schema-form-root
                        [schema]="schema"
                        [preset]="presetDocument"
                        [private-fields]="hideFields"
                        [readonly-fields]="presetReadonlyFields"
                        [dryRun]="dryRun"
                        [policyId]="policyId"
                        [blockId]="id"
                        [rules]="rulesResults"
                        [isFormForRequestBlock]="true"
                        [saveShown]="!edit || draft"
                        [comesFromDialog]="true"
                        [showButtons]="false"
                        cancelText = "Cancel"
                        submitText = "Validate & Create"
                        saveText = "Save Draft"
                        (form)="initForm($event)"
                        (buttons)="onChangeButtons($event)"
                        (cancelBtnEvent)="handleCancelBtnEvent($event, this)"
                        (submitBtnEvent)="handleSubmitBtnEvent($event, this)"
                        (saveBtnEvent)="handleSaveBtnEvent($event, this)"
                    >
                    </app-schema-form-root>
                </div>
            </form>
            <div class="wallet-container" [attr.visibility]="isStep(1)">
                <div class="wallet-type-values">
                    <div class="wallet-type-value">
                        <div class="wallet-type-value-select">
                            <p-radioButton
                                class="guardian-radio-button radio-button-24"
                                name="types"
                                value="account"
                                [(ngModel)]="walletType"
                                inputId="type_1"></p-radioButton>
                        </div>
                        <label class="wallet-type-value-name" for="type_1">
                            User Account
                        </label>
                    </div>
                    <div class="wallet-type-config" [attr.selected]="walletType==='account'">
                        Current Account: {{user.hederaAccountId}}
                    </div>


                    <div class="wallet-type-value">
                        <div class="wallet-type-value-select">
                            <p-radioButton
                                class="guardian-radio-button radio-button-24"
                                name="types"
                                value="wallet"
                                [(ngModel)]="walletType"
                                inputId="type_2"></p-radioButton>
                        </div>
                        <label class="wallet-type-value-name" for="type_2">
                            Use existing Wallet
                        </label>
                    </div>
                    <div class="wallet-type-config" [attr.selected]="walletType==='wallet'">
                        <p-dropdown
                            [(ngModel)]="currentWallet"
                            [options]="wallets"
                            [showClear]="false"
                            class="guardian-dropdown"
                            optionLabel="name"
                            optionValue="account"
                            placeholder="Select Wallet"
                            panelStyleClass="guardian-dropdown-panel">
                        </p-dropdown>
                    </div>

                    <div class="wallet-type-value">
                        <div class="wallet-type-value-select">
                            <p-radioButton
                                class="guardian-radio-button radio-button-24"
                                name="types"
                                value="new"
                                [(ngModel)]="walletType"
                                inputId="type_3"></p-radioButton>
                        </div>
                        <label class="wallet-type-value-name" for="type_3">
                            New Wallet
                        </label>
                    </div>
                    <div class="wallet-type-config" [attr.selected]="walletType==='new'">
                        <form class="wallet-form" [formGroup]="walletForm" autocomplete="off">
                            <div class="guardian-input-container" style="grid-column: 1 / 3;">
                                <label class="form-label" htmlFor="name">* Wallet Name</label>
                                <input formControlName="name" id="name" pInputText type="text" [readonly]="walletType!=='new'" autocomplete="off" />
                            </div>

                            <div class="guardian-input-container">
                                <label class="form-label" htmlFor="account">* Account ID</label>
                                <input formControlName="account" id="account" pInputText type="text" [readonly]="walletType!=='new'" autocomplete="off" />
                            </div>
                            <div class="guardian-input-container">
                                <label class="form-label" htmlFor="key">* Wallet Key</label>
                                <p-password formControlName="key" id="key" [toggleMask]="true" autocomplete="off" [feedback]="false" />
                            </div>
                        </form>
                        <button 
                            (click)="onGenerateWallet()" 
                            [disabled]="walletType!=='new'"
                            class="guardian-button guardian-button-secondary">Generate New Account & Key</button>
                    </div>


                </div>
            </div>
            <div class="result-container" [attr.visibility]="isStep(2)"></div>
        </div>
    </div>
</div>
<div class="dialog-footer">
    <div class="action-buttons">
        <div
            *ngFor="let config of buttons"
            [attr.visible]="config.visible()"
            [attr.id]="config.id"
            class="dialog-button">
            <button
                (click)="config.fn()"
                [disabled]="ifDisabledBtn(config)"
                class="guardian-button guardian-button-{{config.type}}"
            >
                <svg-icon *ngIf="config.iconPath" src="{{config.iconPath}}" svgClass="save-icon-color"></svg-icon>
                {{getButtonName(config)}}
            </button>
        </div>
        <div *ngIf="lastSavedAt" class="last-autosave">
            {{ minutesAgo$ | async }}
        </div>
    </div>
</div>
