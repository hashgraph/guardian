<div class="content">

    <div class="page-title">Tools</div>

    <!-- <div *ngIf="loading && taskId" class="loading">
        <async-progress class="loading-progress" [taskId]="taskId" [expected]="expectedTaskMessages"
            (error)="onAsyncError($event)" (completed)="onAsyncCompleted()"></async-progress>
    </div> -->

    <ng-container *ngIf="!isConfirmed">
        <div class="not-exist">
            Before starting work you need to get DID <a [routerLink]="['/profile']">here</a>
        </div>
    </ng-container>

    <ng-container *ngIf="isConfirmed && tools">
        <div class="actions-container">
            <div style="margin-left: auto; display: flex; gap: 8px;">
                <p-button
                        (click)="newTool()"
                        [pTooltip]="'Create New'"
                        class="toolbar-btn-primary"
                        label="Create New"
                        tooltipPosition="bottom"
                >
                    <svg
                            fill="none"
                            height="24"
                            viewBox="0 0 24 24"
                            width="24"
                            xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                                d="M20 12C20 12.6227 19.4952 13.1275 18.8725 13.1275H13.1275V18.8725C13.1275 19.4952 12.6227 20 12 20C11.3773 20 10.8725 19.4952 10.8725 18.8725V13.1275H5.12752C4.50481 13.1275 4 12.6227 4 12C4 11.3773 4.50481 10.8725 5.12752 10.8725H10.8725V5.12752C10.8725 4.50481 11.3773 4 12 4C12.6227 4 13.1275 4.50481 13.1275 5.12752V10.8725H18.8725C19.4952 10.8725 20 11.3773 20 12Z"
                                fill="white"
                        />
                    </svg>
                </p-button>
                <p-button
                        (click)="importTool()"
                        [pTooltip]="'Import'"
                        class="toolbar-btn-primary"
                        label="Import"
                        tooltipPosition="bottom"
                >
                    <svg
                            fill="none"
                            height="24"
                            viewBox="0 0 24 24"
                            width="24"
                            xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                                clip-rule="evenodd"
                                d="M11.0001 3C11.0001 2.44771 11.4478 2 12.0001 2C12.5524 2 13.0001 2.44772 13.0001 3V11.5858L15.293 9.29285C15.6836 8.90232 16.3167 8.90232 16.7073 9.29285C17.0978 9.68337 17.0978 10.3165 16.7073 10.7071L12.7073 14.7071L12.7072 14.707C12.5263 14.888 12.2762 15 12.0001 15C11.7239 15 11.4739 14.888 11.2929 14.707L11.2929 14.7071L7.29289 10.7071C6.90237 10.3165 6.90237 9.68337 7.29289 9.29285C7.68342 8.90232 8.31658 8.90232 8.70711 9.29285L11.0001 11.5858V3ZM5 14.5C5 13.9477 4.55228 13.5 4 13.5C3.44772 13.5 3 13.9477 3 14.5V18C3 19.6569 4.34315 21 6 21H18C19.6569 21 21 19.6569 21 18V14.5C21 13.9477 20.5523 13.5 20 13.5C19.4477 13.5 19 13.9477 19 14.5V18C19 18.5523 18.5523 19 18 19H6C5.44772 19 5 18.5523 5 18V14.5Z"
                                fill="white"
                                fill-rule="evenodd"
                        />
                    </svg>
                </p-button>
                <p-button
                        (click)="compareTools()"
                        [pTooltip]="'Compare'"
                        class="toolbar-btn-secondary"
                        label="Compare"
                        styleClass="p-button-outlined"
                        tooltipPosition="bottom"
                >
                    <svg
                            fill="none"
                            height="24"
                            viewBox="0 0 24 24"
                            width="24"
                            xmlns="http://www.w3.org/2000/svg"
                    >
                        <g clip-path="url(#clip0_1435_5281)">
                            <mask
                                    height="25"
                                    id="mask0_1435_5281"
                                    maskUnits="userSpaceOnUse"
                                    style="mask-type: luminance;"
                                    width="24"
                                    x="0"
                                    y="-1"
                            >
                                <path
                                        d="M24 -0.000488281H0V23.9995H24V-0.000488281Z"
                                        fill="white"
                                />
                            </mask>
                            <g mask="url(#mask0_1435_5281)">
                                <path
                                        class="primary-color"
                                        clip-rule="evenodd"
                                        d="M12 0.999512C12.5523 0.999512 13 1.44723 13 1.99951L13 2.99951C13.5523 2.99951 14 3.44723 14 3.99951C14 4.5518 13.5523 4.99951 13 4.99951V18.9995C13.5523 18.9995 14 19.4472 14 19.9995C14 20.5518 13.5523 20.9995 13 20.9995L13 21.9995C13 22.5518 12.5523 22.9995 12 22.9995C11.4477 22.9995 11 22.5518 11 21.9995V20.9995H6C4.34316 20.9995 3 19.6564 3 17.9995V5.99951C3 4.34267 4.34314 2.99951 6 2.99951H11V1.99951C11 1.44723 11.4477 0.999512 12 0.999512ZM11 4.99951H6C5.44772 4.99951 5 5.44723 5 5.99951V17.9995C5 18.5518 5.44771 18.9995 6 18.9995H11V4.99951ZM16 3.99951C16 3.44723 16.4477 2.99951 17 2.99951H18C19.6569 2.99951 21 4.34268 21 5.99951V6.99951C21 7.5518 20.5523 7.99951 20 7.99951C19.4477 7.99951 19 7.5518 19 6.99951V5.99951C19 5.44722 18.5523 4.99951 18 4.99951H17C16.4477 4.99951 16 4.5518 16 3.99951ZM20 9.99952C20.5523 9.99952 21 10.4472 21 10.9995V12.9995C21 13.5518 20.5523 13.9995 20 13.9995C19.4477 13.9995 19 13.5518 19 12.9995V10.9995C19 10.4472 19.4477 9.99952 20 9.99952ZM20 15.9995C20.5523 15.9995 21 16.4472 21 16.9995V17.9995C21 19.6564 19.6569 20.9995 18 20.9995H17C16.4477 20.9995 16 20.5518 16 19.9995C16 19.4472 16.4477 18.9995 17 18.9995H18C18.5523 18.9995 19 18.5518 19 17.9995V16.9995C19 16.4472 19.4477 15.9995 20 15.9995Z"
                                        fill-rule="evenodd"
                                />
                            </g>
                        </g>
                        <defs>
                            <clipPath id="clip0_1435_5281">
                                <rect fill="white" height="24" width="24"/>
                            </clipPath>
                        </defs>
                    </svg>
                </p-button>
            </div>
        </div>

        <ng-container *ngIf="tools && tools.length > 0; else noData">
            <div class="table-container">
                <p-table [value]="tools">
                    <ng-template pTemplate="header">
                        <tr>
                            <!-- <th
                                 class="header-cell-text"
                                 style="min-width: 140px; max-width: 150px;"
                             >
                                 UUID
                             </th>-->
                            <th
                                class="header-cell-text"
                                style="min-width: 140px; max-width: 150px;"
                            >
                                Name
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 140px; max-width: 150px;"
                            >
                                Description
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 140px;"
                            >
                                Schemas
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 140px;"
                            >
                                Status
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 140px;"
                            >
                                Hedera Topic Id
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 165px;"
                            >
                                Tags
                            </th>
                            <th
                                *ngIf="canPublishAnyTool"
                                class="header-cell-text"
                                style="min-width: 140px;"
                            >
                                Operations
                            </th>
                            <th
                                class="header-cell-text"
                                style="min-width: 140px;"
                            >
                                {{ !canPublishAnyTool ? 'Operations' : '' }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template let-tool pTemplate="body">
                        <tr class="policy-grid-row">
                            <!--<td
                                class="first-policy-grid-cell text-truncate"
                                pTooltip="{{ tool.uuid }}"
                                tooltipPosition="top"
                                style="min-width: 140px; max-width: 150px;"
                            >
                                {{ tool.uuid }}
                            </td>-->
                            <td
                                class="first-policy-grid-cell text-truncate"
                                pTooltip="{{ tool.name }}"
                                style="min-width: 140px; max-width: 150px;"
                                tooltipPosition="top"
                            >
                                {{ tool.name || '–' }}
                            </td>
                            <td
                                class="text-truncate"
                                pTooltip="{{ tool.description }}"
                                style="min-width: 140px; max-width: 150px;"
                                tooltipPosition="top"
                            >
                                {{ tool.description || '–' }}
                            </td>
                            <td style="min-width: 140px;">
                                <a [queryParams]="{
                                    type: 'tool',
                                    topic: tool.topicId
                                }" [routerLink]="['/schemas']">Schemas</a>
                            </td>
                            <td style="min-width: 140px;">
                                <span [ngSwitch]="tool.status">
                                    <div *ngSwitchCase="'DRAFT'" class="p-tag p-tag-grey">
                                        Draft
                                    </div>
                                    <div *ngSwitchCase="'PUBLISHED'" class="p-tag p-tag-success">
                                        Published
                                    </div>
                                    <div *ngSwitchDefault class="p-tag p-tag-grey">
                                        {{ tool.status || '–' }}
                                    </div>
                                </span>
                            </td>
                            <td style="min-width: 140px;">
                                <hedera-explorer [params]="tool.topicId" type="topics">
                                    {{ tool.topicId }}
                                </hedera-explorer>
                            </td>
                            <td
                                style="min-width: 165px;"
                            >
                                <tags-explorer
                                    [data]="tool._tags"
                                    [entity]="tagEntity"
                                    [owner]="owner"
                                    [schemas]="tagSchemas"
                                    [service]="tagsService"
                                    [target]="tool.id"></tags-explorer>
                            </td>
                            <td
                                *ngIf="canPublishAnyTool"
                                class="last-policy-grid-cell"
                            >
                                <div *ngIf="tool.status === 'DRAFT'"
                                     class="commands-line"
                                >
                                    <button
                                        (click)="publishTool(tool)"
                                        class="button height-28"
                                        pButton
                                        type="button"
                                    >
                                        Publish
                                    </button>
                                </div>
                            </td>
                            <td
                                class="last-policy-grid-cell"
                                style="min-width: 140px;"
                            >
                                <div class="commands-line">
                                    <div
                                        [queryParams]="{toolId: tool.id}"
                                        [routerLink]="['/policy-configuration']"
                                        class="btn-icon-edit"
                                        matTooltip="Edit"
                                        matTooltipClass="guardian-tooltip"
                                        matTooltipHideDelay="100"
                                        matTooltipPosition="above"
                                        matTooltipShowDelay="500"
                                    >
                                        <svg
                                            class="opacity-icon"
                                            fill="none"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            width="24"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                class="primary-color"
                                                clip-rule="evenodd"
                                                d="M16.5084 6.31676C16.8031 6.03714 17.1971 5.8857 17.6038 5.89575C18.0105 5.9058 18.3966 6.07652 18.677 6.37035C18.9574 6.66418 19.1093 7.05705 19.0992 7.46253C19.0892 7.86802 18.9179 8.25291 18.6232 8.53252L8.08714 18.5537L5.37201 18.9094L6.48508 15.8059L16.5075 6.31771L16.5084 6.31676ZM20.0522 5.0628C19.4242 4.40569 18.5605 4.02384 17.6505 4.00108C16.7405 3.97832 15.8586 4.3165 15.1984 4.94139L5.00859 14.586C4.90058 14.6882 4.81814 14.8143 4.7679 14.9541L3.05549 19.7318C3.00064 19.8848 2.98614 20.0494 3.01339 20.2096C3.04063 20.3698 3.10871 20.5204 3.21109 20.6468C3.31346 20.7733 3.44671 20.8714 3.59804 20.9317C3.74938 20.9921 3.91373 21.0126 4.07533 20.9915L8.64177 20.3939C8.84179 20.3679 9.02835 20.2792 9.17452 20.1406L19.9351 9.90599C20.5946 9.27903 20.9773 8.4166 20.999 7.50836C21.0208 6.60012 20.6808 5.72045 20.0522 5.0628ZM13.466 19.1029C13.2137 19.1029 12.9717 19.2029 12.7933 19.3808C12.6149 19.5586 12.5147 19.7999 12.5147 20.0515C12.5147 20.303 12.6149 20.5443 12.7933 20.7222C12.9717 20.9001 13.2137 21 13.466 21H19.1741C19.4264 21 19.6684 20.9001 19.8468 20.7222C20.0252 20.5443 20.1254 20.303 20.1254 20.0515C20.1254 19.7999 20.0252 19.5586 19.8468 19.3808C19.6684 19.2029 19.4264 19.1029 19.1741 19.1029H13.466Z"
                                                fill="#23252E"
                                                fill-rule="evenodd"
                                            />
                                        </svg>
                                    </div>
                                    <div
                                        (click)="exportTool(tool)"
                                        class="operations-icon-container"
                                        matTooltip="Export"
                                        matTooltipClass="guardian-tooltip"
                                        matTooltipHideDelay="100"
                                        matTooltipPosition="above"
                                        matTooltipShowDelay="500"
                                    >
                                        <svg
                                            class="opacity-icon"
                                            fill="none"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            width="24"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                class="primary-color"
                                                clip-rule="evenodd"
                                                d="M11.0001 15C11.0001 15.5523 11.4478 16 12.0001 16C12.5524 16 13.0001 15.5523 13.0001 15V6.41418L15.293 8.70715C15.6836 9.09768 16.3167 9.09768 16.7073 8.70715C17.0978 8.31663 17.0978 7.68346 16.7073 7.29294L12.7073 3.29294L12.7072 3.29295C12.5263 3.11195 12.2762 3 12.0001 3C11.7239 3 11.4739 3.11195 11.2929 3.29295L11.2929 3.29294L7.29289 7.29294C6.90237 7.68346 6.90237 8.31663 7.29289 8.70715C7.68342 9.09768 8.31658 9.09768 8.70711 8.70715L11.0001 6.41419V15ZM5 14.5C5 13.9477 4.55228 13.5 4 13.5C3.44772 13.5 3 13.9477 3 14.5V18C3 19.6569 4.34315 21 6 21H18C19.6569 21 21 19.6569 21 18V14.5C21 13.9477 20.5523 13.5 20 13.5C19.4477 13.5 19 13.9477 19 14.5V18C19 18.5523 18.5523 19 18 19H6C5.44772 19 5 18.5523 5 18V14.5Z"
                                                fill="#23252E"
                                                fill-rule="evenodd"
                                            />
                                        </svg>
                                    </div>
                                    <div
                                        (click)="tool.status ==='DRAFT' ? deleteTool(tool) : null"
                                        class="operations-icon-container"
                                        matTooltip="Delete"
                                        matTooltipClass="guardian-tooltip"
                                        matTooltipHideDelay="100"
                                        matTooltipPosition="above"
                                        matTooltipShowDelay="500"
                                    >
                                        <svg
                                            class="opacity-icon"
                                            fill="none"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            width="24"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                [class.disabled-color]="tool.status !== 'DRAFT'"
                                                class="accent-color-red"
                                                clip-rule="evenodd"
                                                d="M10 4C9.44771 4 9 4.44771 9 5V6H15V5C15 4.44771 14.5523 4 14 4H10ZM17 6V5C17 3.34315 15.6569 2 14 2H10C8.34315 2 7 3.34315 7 5V6H5C4.44772 6 4 6.44771 4 7C4 7.55228 4.44772 8 5 8V18C5 19.6569 6.34315 21 8 21H16C17.6569 21 19 19.6569 19 18V8C19.5523 8 20 7.55228 20 7C20 6.44771 19.5523 6 19 6H17ZM17 8H7V18C7 18.5523 7.4477 19 8 19H16C16.5523 19 17 18.5523 17 18V8ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z"
                                                fill="#FF432A"
                                                fill-rule="evenodd"
                                            />
                                        </svg>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>

            <app-paginator 
                [pageIndex]="pageIndex" 
                [pageSize]="pageSize" 
                [length]="toolsCount"
                (page)="onPage($event)"
            ></app-paginator>

        </ng-container>
        <!-- <div class="table-container">
            <table mat-table [dataSource]="tools" class="table">
                <ng-container matColumnDef="uuid">
                    <th mat-header-cell *matHeaderCellDef> UUID </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.uuid }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.name }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef> Description </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.description }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="schemas">
                    <th mat-header-cell *matHeaderCellDef> Schemas </th>
                    <td mat-cell *matCellDef="let element">
                        <a [routerLink]="['/schemas']" [queryParams]="{
                            type: 'tool',
                            topic: element.topicId
                        }">Schemas</a>
                    </td>
                </ng-container>
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Status </th>
                    <td mat-cell *matCellDef="let element">
                        <span [ngSwitch]="element.status">
                            <div *ngSwitchCase="'DRAFT'">
                                <span class="module-status status-DRAFT">Draft</span>
                            </div>
                            <div *ngSwitchCase="'PUBLISHED'">
                                <span class="module-status status-PUBLISHED">Published</span>
                            </div>
                            <div *ngSwitchDefault>
                                <span class="module-status">{{element.status}}</span>
                            </div>
                        </span>
                    </td>
                </ng-container>
                <ng-container matColumnDef="topic">
                    <th mat-header-cell *matHeaderCellDef> Hedera Topic Id </th>
                    <td mat-cell *matCellDef="let element">
                        <hedera-explorer type="topics"
                            [params]="element.topicId">{{element.topicId}}</hedera-explorer>
                    </td>
                </ng-container>
                <ng-container matColumnDef="tags">
                    <th mat-header-cell *matHeaderCellDef> Tags </th>
                    <td mat-cell *matCellDef="let element">
                        <tags-explorer
                            [data]="element._tags"
                            [owner]="owner"
                            [target]="element.id"
                            [schemas]="tagSchemas"
                            [entity]="tagEntity"
                            [service]="tagsService"></tags-explorer>
                    </td>
                </ng-container>
                <ng-container matColumnDef="operation">
                    <th mat-header-cell *matHeaderCellDef> Operations </th>
                    <td mat-cell *matCellDef="let element">
                        <div *ngIf="element.status =='DRAFT'" class="btn-publish" (click)="publishTool(element)">
                            Publish
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="operations">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let element">
                        <div class="commands-line">
                            <div class="btn-icon-import" (click)="exportTool(element)" matTooltip="Export"
                                 matTooltipClass="guardian-tooltip" matTooltipPosition="above">
                                <mat-icon>import_export</mat-icon>
                            </div>
                            <div [queryParams]="{ toolId: element.id }"
                                 [routerLink]="['/policy-configuration']"
                                 class="btn-icon-edit" matTooltip="Edit" matTooltipClass="guardian-tooltip"
                                 matTooltipPosition="above">
                                <mat-icon>edit</mat-icon>
                            </div>
                            <div *ngIf="element.status =='DRAFT'" class="btn-icon-delete"
                                 (click)="deleteTool(element)" matTooltip="Delete" matTooltipClass="guardian-tooltip"
                                 matTooltipPosition="above">
                                <mat-icon>delete</mat-icon>
                            </div>
                            <div *ngIf="element.status !='DRAFT'" class="btn-icon-delete-des">
                                <mat-icon>delete</mat-icon>
                            </div>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: columns;"></tr>
            </table>
        </div>
        <div class="table-paginator">
            <mat-paginator [length]="toolsCount" [pageIndex]="pageIndex" [pageSize]="pageSize"
                [pageSizeOptions]="[10, 25, 50, 100]" (page)="onPage($event)" aria-label="Select page">
            </mat-paginator>
        </div> -->
    </ng-container>
</div>

<ng-template #noData>
    <div class="not-exist">
        <svg
                fill="none"
                height="32"
                viewBox="0 0 32 32"
                width="32"
                xmlns="http://www.w3.org/2000/svg"
        >
            <path
                    class="disabled-color"
                    clip-rule="evenodd"
                    d="M2.66699 8C2.66699 6.89543 3.56243 6 4.66699 6C5.77156 6 6.66699 6.89543 6.66699 8C6.66699 9.10457 5.77156 10 4.66699 10C3.56243 10 2.66699 9.10457 2.66699 8ZM9.33366 8.00082C9.3337 7.26444 9.93069 6.66752 10.6671 6.66756L28.0004 6.66852C28.7368 6.66856 29.3337 7.26555 29.3337 8.00193C29.3336 8.73831 28.7366 9.33523 28.0002 9.33519L10.6669 9.33423C9.93054 9.33419 9.33362 8.7372 9.33366 8.00082ZM2.66699 16C2.66699 14.8956 3.56236 14 4.66699 14C5.77163 14 6.66699 14.8956 6.66699 16C6.66699 17.1044 5.77163 18 4.66699 18C3.56236 18 2.66699 17.1044 2.66699 16ZM9.33366 16.0009C9.3337 15.2645 9.93069 14.6676 10.6671 14.6676L28.0004 14.6687C28.7368 14.6687 29.3337 15.2657 29.3337 16.0021C29.3336 16.7385 28.7366 17.3354 28.0002 17.3353L10.6669 17.3343C9.93053 17.3342 9.33361 16.7372 9.33366 16.0009ZM2.66699 24C2.66699 22.8956 3.56236 22 4.66699 22C5.77163 22 6.66699 22.8956 6.66699 24C6.66699 25.1044 5.77163 26 4.66699 26C3.56236 26 2.66699 25.1044 2.66699 24ZM9.33366 24.0009C9.3337 23.2645 9.93069 22.6676 10.6671 22.6676L28.0004 22.6687C28.7368 22.6687 29.3337 23.2657 29.3337 24.0021C29.3336 24.7385 28.7366 25.3354 28.0002 25.3353L10.6669 25.3343C9.93053 25.3342 9.33361 24.7372 9.33366 24.0009Z"
                    fill-rule="evenodd"
            />
        </svg>
        <span class="info-text-strong">There were no Tool created yet</span>
        <span class="info-text">Please create new tool to see the data</span>
    </div>
</ng-template>

<ng-template #preloader>
    <div class="preloader-image"></div>
</ng-template>

<div *ngIf="loading" class="loading">
    <div class="preloader-image preloader-image-l-size"></div>
</div>
