<app-dialog-wrapper
    (cancel)="onNoClick()"
    [confirmVisible]="retireMod"
    [syncVisible]="false"
    [loading]="loading"
    [confirmDisabled]="!retireForm.valid"
    [title]="retireMod ? 'Retire' : 'Pools'"
    [paginatorVisible]="!retireMod"
    [length]="length"
    [pageSize]="pageSize"
    (page)="onPage($event)"
    (confirm)="confirm()"
>
    <ng-container *ngIf="!retireMod; else retireView">
        <div class="action-buttons">
            <label for="tokens" class="action-field__label">Token</label>
            <p-multiSelect
                id="tokens"
                [(ngModel)]="selectedTokens"
                [options]="getTokenOptions()"
                optionLabel="label"
                optionValue="value"
                [showHeader]="false"
                defaultLabel="Not selected"
                [filter]="true"
                [appendTo]="'body'"
                (onChange)="loadPools()"
            >
                <ng-template let-item pTemplate="item">
                    {{ item.label }}
                </ng-template>
            </p-multiSelect>
        </div>

        <div class="pools-head" *ngIf="pools?.length">
            <div class="ph ph--tokens"></div>
            <div class="ph wipe-permission">WIPE PERMISSION</div>
            <div class="ph retire-request">RETIRE REQUEST</div>
            <div class="ph ph--trash"></div>
        </div>

        <div *ngIf="pools?.length; else noPools" class="table-tokens">
            <div class="pool" *ngFor="let pool of pools">
                <div class="tokens tokens-scroll">
                    <div class="token-card" *ngFor="let token of pool.tokens">
                        <div class="token-card__name">NAME<br>
                            <div class="token-card_value">{{ token.tokenSymbol }}</div>
                        </div>
                        <div class="token-card__token">TOKEN<br>
                            <div class="token-card_value">{{ token.token }}</div>
                        </div>
                        <div class="token-card__count">COUNT<br>
                            <div class="token-card_value">{{ token.count | tokenCount: token.decimals }}</div>
                        </div>
                    </div>
                </div>
                <div class="pool-permissions">
                    <div class="permission enabled">Enabled</div>
                    <div class="approval" [ngClass]="{
                        'need-approval': !pool.immediately,
                        'no-approval': pool.immediately
                    }">
                        {{ pool.immediately ? 'Without approval' : 'Need approval' }}
                    </div>
                </div>
                <button
                    pTooltip="Retire"
                    tooltipPosition="top"
                    appendTo="body"
                    aria-label="Retire"
                    (click)="retire(pool)"
                    class="btn btn--retire">
                    <i class="pi pi-trash"></i>
                </button>
            </div>
        </div>
    </ng-container>
</app-dialog-wrapper>

<ng-template #noPools>
    <div class="no-pools">There are no pools</div>
</ng-template>

<ng-template #retireView>
    <div class="retire">
        <button class="retire__back" mat-icon-button (click)="back()">
            <i class="pi pi-arrow-left"></i>
            Back
        </button>
        <div class="tokens">
            <div class="token-card" *ngFor="let token of selectedPool.tokens; let i = index">
                <div class="token-card__name">NAME<br>
                    <div class="token-card_value">{{ token.tokenSymbol }}</div>
                </div>
                <div class="token-card__token">TOKEN<br>
                    <div class="token-card_value">{{ token.token }}</div>
                </div>
                <div class="token-card__count">COUNT<br>
                    <div class="token-card_value">{{ token.count | tokenCount: token.decimals }}</div>
                </div>
                <form [formGroup]="getRetireForm(i)">
                    <div *ngIf="token.type === 'fungible'" class="p-fluid">
                        <label>Count</label>
                        <p-inputNumber formControlName="count" placeholder="1" mode="decimal" [showButtons]="true"
                                       [step]="1" [min]="1"></p-inputNumber>
                    </div>
                    <div *ngIf="token.type === 'non-fungible'" class="p-fluid">
                        <label>Serials</label>
                        <p-multiSelect [styleClass]="'retire-serials-ms'"
                                       panelStyleClass="retire-serials-ms__panel"
                                       formControlName="serials"
                                       [options]="getSerialOptions(token.serials)"
                                       optionLabel="label"
                                       optionValue="value"
                                       [appendTo]="'body'"
                                       placeholder="Select Serials">
                        </p-multiSelect>
                    </div>
                </form>
            </div>
        </div>
    </div>
</ng-template>

<div class="pools-dialog__footer" *ngIf="!retireMod">
    <button
        type="button"
        pButton
        label="Close"
        class="p-button-outlined pools-dialog__close-btn"
        (click)="onNoClick()">
    </button>
</div>
