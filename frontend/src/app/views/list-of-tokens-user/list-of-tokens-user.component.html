<div *ngIf="!loading" class="container">
    <div class="back-button">
        <button 
            *ngIf="tokenId" 
            (click)="goToTokensPage()" 
            class="guardian-button guardian-button-secondary">
            <div class="guardian-button-icon">
                <svg-icon class="icon-btn svg-icon"
                    src="/assets/images/icons/left-arrow.svg"
                    svgClass="icon-color-primary">
                </svg-icon>
            </div>
            <div class="guardian-button-label">Back to List of Tokens</div>
        </button>
    </div>

    <div *ngIf="tokenId" class="header">
        <h1>{{tokenName}}</h1>
        <div class="token-id">
            <span class="token-id-name">Token ID:</span>
            <span class="token-id-value">{{ tokenId }}</span>
        </div>
    </div>

    <div *ngIf="!tokenId" class="header">
        <h1>List of Tokens</h1>
    </div>

    <ng-container *ngIf="isConfirmed; else noDIDSettings">

        <ng-container *ngIf="!tokenId; else usingTokens">
            <div *ngIf="loading" class="guardian-loading">
                <div class="guardian-loading-image"></div>
            </div>
            <div *ngIf="!loading" class="guardian-user-page-grid">
                <ng-container *ngIf="tokens && tokens.length > 0; else noData">
                    <div class="guardian-grid-container">
                        <p-table
                            class="guardian-grid-table"
                            [value]="tokens"
                            [scrollable]="true"
                        >
                            <ng-template pTemplate="header">
                                <tr class="guardian-grid-header">
                                    <ng-container *ngFor="let column of columns">
                                        <th
                                            *ngIf="!column.canDisplay || column.canDisplay()"
                                            class="header-cell-{{column.type}} col-{{column.size}}"
                                            >{{column.title}}</th>
                                    </ng-container>
                                </tr>
                            </ng-template>
                            <ng-template let-row pTemplate="body">
                                <tr class="guardian-grid-row">
                                    <ng-container *ngFor="let column of columns">
                                        <td
                                            *ngIf="!column.canDisplay || column.canDisplay()"
                                            class="row-cell-{{column.type}} col-{{column.size}}"
                                            pTooltip="{{row[column.id]}}"
                                            [tooltipDisabled]="!column.tooltip"
                                            tooltipPosition="top"
                                            [showDelay]="1000"
                                            [ngSwitch]="column.id"
                                        >
                                            <ng-container *ngSwitchCase="'id'">
                                                <hedera-explorer 
                                                    *ngIf="!row.draftToken else draftToken" 
                                                    [params]="row.tokenId" 
                                                    type="tokens"
                                                >{{ row.tokenId }}</hedera-explorer>
                                                <ng-template #draftToken>Draft Token</ng-template>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'name'">
                                                <span class="text-truncate">{{row.tokenName}}</span>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'symbol'">
                                                <span class="text-truncate">{{row.tokenSymbol}}</span>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'policies'">
                                                <span class="text-truncate">{{row.policies?.join(', ')}}</span>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'tags'">
                                                <tags-explorer
                                                        *ngIf="user.TAGS_TAG_READ"
                                                        [user]="user"
                                                        [data]="row._tags"
                                                        [entity]="tagEntity"
                                                        [owner]="owner"
                                                        [schemas]="tagSchemas"
                                                        [service]="tagsService"
                                                        [target]="row.id"></tags-explorer>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'options'">
                                                <div
                                                    class="guardian-icon-button big"
                                                    (click)="goToUsingTokens(row)"
                                                >
                                                    <svg-icon
                                                        class="icon-btn"
                                                        src="/assets/images/icons/wallet.svg"
                                                        svgClass="icon-color-primary">
                                                    </svg-icon>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngSwitchDefault>
                                                <span class="text-truncate">{{row[column.id]}}</span>
                                            </ng-container>
                                        </td>
                                    </ng-container>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="guardian-grid-paginator">
                            <app-paginator
                                class="guardian-grid-paginator"
                                [pageIndex]="pageIndex"
                                [pageSize]="pageSize"
                                [length]="tokensCount"
                                (page)="onPage($event)"
                            ></app-paginator>
                        </div>
                    </div>
                </ng-container>
                <ng-template #noData>
                    <div class="guardian-user-not-data">
                        <svg-icon
                            class="svg-icon-32"
                            src="/assets/images/icons/32/list.svg"
                            svgClass="icon-color-disabled"></svg-icon>
                        <span class="guardian-user-not-data__text-strong">There are no tokens created yet</span>
                        <span class="guardian-user-not-data__text">Please create a new token to see the data</span>
                    </div>
                </ng-template>
            </div>
        </ng-container>
        <ng-template #usingTokens>
            <div *ngIf="loading" class="guardian-loading">
                <div class="guardian-loading-image"></div>
            </div>
            <div *ngIf="!loading" class="guardian-user-page-grid">
                <ng-container *ngIf="users && users.length > 0; else noData">
                    <div class="guardian-grid-container">
                        <p-table
                            class="guardian-grid-table"
                            [value]="users"
                            [scrollable]="true"
                        >
                            <ng-template pTemplate="header">
                                <tr class="guardian-grid-header">
                                    <ng-container *ngFor="let column of usersColumns">
                                        <th
                                            *ngIf="!column.canDisplay || column.canDisplay()"
                                            class="header-cell-{{column.type}} col-{{column.size}}"
                                            >{{column.title}}</th>
                                    </ng-container>
                                </tr>
                            </ng-template>
                            <ng-template let-row pTemplate="body">
                                <tr class="guardian-grid-row">
                                    <ng-container *ngFor="let column of usersColumns">
                                        <td
                                            *ngIf="!column.canDisplay || column.canDisplay()"
                                            class="row-cell-{{column.type}} col-{{column.size}}"
                                            pTooltip="{{row[column.id]}}"
                                            [tooltipDisabled]="!column.tooltip"
                                            tooltipPosition="top"
                                            [showDelay]="1000"
                                            [ngSwitch]="column.id"
                                        >
                                            <ng-container *ngSwitchCase="'username'">
                                                <span class="text-truncate">{{row.username}}</span>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'id'">
                                                <hedera-explorer [params]="row.relayerAccountId || ''" type="accounts">
                                                    {{ row.relayerAccountId }}
                                                </hedera-explorer>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'name'">
                                                <span class="text-truncate">{{row.relayerAccountName || ''}}</span>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'balance'"> 
                                                <div *ngIf="row.loading" class="options-container">
                                                    <div class="loading-placeholder balance-size"></div>
                                                </div>
                                                <div *ngIf="!row.loading && row.associated === 'Yes'" class="options-container">
                                                    <div class="user-balance balance-size">{{ row.balance }}</div>
                                                </div>
                                                <div *ngIf="!row.loading && row.associated === 'No'" class="options-container">
                                                    No associated
                                                </div>
                                                <div *ngIf="!row.loading && row.associated === 'n/a'" class="options-container">
                                                    No Data
                                                </div>
                                            </ng-container>

                                        <ng-container *ngSwitchCase="'associate'"> 
                                            <div *ngIf="row.loading" class="options-container">
                                                <div class="loading-placeholder kyc-size"></div>
                                            </div>
                                            <div *ngIf="!row.loading" class="options-container">
                                                <button
                                                    (click)="associate(row)"
                                                    [disabled]="!isLocalUser"
                                                    class="guardian-button guardian-button-secondary associate-size"
                                                >
                                                    <div 
                                                        *ngIf="row.associated !== 'Yes'"
                                                        class="guardian-button-label"
                                                    >Associate</div>
                                                    <div 
                                                        *ngIf="row.associated === 'Yes'"
                                                        class="guardian-button-label"
                                                    >Dissociate</div>
                                                </button>
                                            </div>
                                        </ng-container>

                                            <ng-container *ngSwitchCase="'freeze'">
                                                <div *ngIf="row.loading" class="options-container">
                                                    <div class="loading-placeholder freeze-size"></div>
                                                </div>
                                                <div *ngIf="!row.loading" class="options-container">
                                                    <div class="chip-container">
                                                        <div class="chip chip-color-{{getColor(row.frozen)}}">
                                                            {{ row.enableFreeze ? row.frozen : 'N/A' }}
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'kyc'"> 
                                                <div *ngIf="row.loading" class="options-container">
                                                    <div class="loading-placeholder kyc-size"></div>
                                                </div>
                                                <div *ngIf="!row.loading" class="options-container">
                                                    <div class="chip-container">
                                                        <div class="chip chip-color-{{getColor(row.kyc)}}">
                                                            {{ row.enableKYC ? row.kyc : 'N/A' }}
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngSwitchCase="'refresh'">
                                                <div
                                                    [attr.disabled]="row.loading"
                                                    class="guardian-icon-button big"
                                                    (click)="!row.loading ? refresh(row) : null"
                                                >
                                                    <svg-icon
                                                        class="icon-btn"
                                                        src="/assets/images/icons/refresh-2.svg"
                                                        [svgClass]="!row.loading ? 'icon-color-primary': 'icon-color-disabled'">
                                                    </svg-icon>
                                                </div>
                                            </ng-container>    
                                            <ng-container *ngSwitchDefault>
                                                <span class="text-truncate">{{row[column.id]}}</span>
                                            </ng-container>
                                        </td>
                                    </ng-container>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="guardian-grid-paginator">
                            <app-paginator
                                class="guardian-grid-paginator"
                                [pageIndex]="userPageIndex"
                                [pageSize]="userPageSize"
                                [length]="userPageCount"
                                (page)="onUserPage($event)"
                            ></app-paginator>
                        </div>
                    </div>
                </ng-container>
                <ng-template #noData>
                    <div class="guardian-user-not-data">
                        <svg-icon
                            class="svg-icon-32"
                            src="/assets/images/icons/32/list.svg"
                            svgClass="icon-color-disabled"></svg-icon>
                        <span class="guardian-user-not-data__text-strong">There are no account created yet</span>
                        <span class="guardian-user-not-data__text">Please create a new account to see the data</span>
                    </div>
                </ng-template>
            </div>
        </ng-template>
    </ng-container>
</div>

<ng-template #noDIDSettings>
    <div class="not-exist">
        <span>Before starting work you need to get DID <a [routerLink]="['/profile']">here</a></span>
    </div>
</ng-template>

<ng-template #preloader>
    <div class="preloader-image"></div>
</ng-template>

<!-- todo: why was && !taskId -->
<div *ngIf="loading" class="loading">
    <div class="preloader-image preloader-image-l-size"></div>
</div>
