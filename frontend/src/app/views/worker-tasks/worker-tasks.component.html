<div class="container">
    <ng-container [ngTemplateOutlet]="header"></ng-container>
    <div class="page-filters">
        <p-dropdown
            (onChange)="onFilter($event)"
            [options]="statuses"
            [(ngModel)]="currentStatus"
            optionLabel="name"
            optionValue="value"
            appendTo="body"
            class="guardian-dropdown"
            placeholder="Status"
        ></p-dropdown>
    </div>
    <ng-container *ngIf="!loading">
        <ng-container [ngTemplateOutlet]="tableContainer"></ng-container>
    </ng-container>
    <div *ngIf="loading" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<ng-template #header>
    <div class="header">
        <h1>Worker Tasks</h1>
    </div>
</ng-template>

<ng-template #tableContainer>
    <ng-container *ngIf="workerTasks && workerTasks.length > 0 else noData">
        <div class="table-container">
            <table>
                <colgroup>
                    <col/>
                    <col/>
                    <col/>
                    <col/>
                    <col style="width: 100px;"/>
                </colgroup>
                <tr class="row-header">
                    <th class="col-CREATED">CREATED</th>
                    <th class="col-STARTED">STARTED</th>
                    <th class="col-TYPE">TYPE</th>
                    <th class="col-STATUS">STATUS</th>
                    <th class="col-COMMENTS">COMMENTS</th>
                    <th class="col-ACTION"></th>
                </tr>
                <ng-container *ngFor="let task of workerTasks">
                    <tr class="row-item">
                        <td class="col-CREATED">
                            {{ task.createDate | date: 'yyyy-MM-dd h:mm a' }}
                        </td>
                        <td *ngIf="task.processedTime" class="col-STARTED">
                            {{ task.processedTime | date: 'yyyy-MM-dd h:mm a' }}
                        </td>
                        <td *ngIf="!task.processedTime" class="col-STARTED">
                            Not started yet
                        </td>
                        <td class="col-TYPE">
                            <div>{{ task.type }}</div>
                        </td>
                        <td class="col-STATUS">
                            <div>{{ task.status }}</div>
                        </td>
                        <td class="col-COMMENTS">
                            <div *ngIf="task.status === 'ERROR'">{{ task.errorReason }}</div>
                        </td>
                        <td class="col-ACTION">
                            <div class="operations-container">
                                <button 
                                    (click)="restartTask(task)" 
                                    [disabled]="!(task.isError && task.isRetryableTask)"
                                    class="p-button-raised p-button-rounded p-button-text" 
                                    icon="pi pi-undo"
                                    pButton type="button"></button>
                                <button 
                                    (click)="deleteTask(task)" 
                                    [disabled]="!task.isError" 
                                    class="p-button-raised p-button-rounded p-button-text" 
                                    icon="pi pi-minus"
                                    pButton 
                                    type="button"></button>
                            </div>
                        </td>
                    </tr>
                </ng-container>
            </table>

            <app-paginator
                    (page)="onPage($event)"
                    [length]="workerTasksCount"
                    [pageIndex]="pageIndex"
                    [pageSize]="pageSize"
            ></app-paginator>

        </div>
    </ng-container>
</ng-template>

<ng-template #noData>
    <div class="not-exist">
        <svg-icon class="svg-icon-32" src="/assets/images/icons/32/list.svg" svgClass="disabled-color">
        </svg-icon>
        <span class="info-text-strong">No active tasks</span>
        <span class="info-text"></span>
    </div>
</ng-template>
